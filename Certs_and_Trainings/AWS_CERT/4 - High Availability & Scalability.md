
#aws #AWS_CERT 

vertical: mas recursos en la instancia
horizontal: mas instancias

**Avalability**: Estar en varias AZ (data centers). Redundancia.

Scale out ---> incrementar instancias
scale in.   ---> reducir

##### Elastic Load Balancer
AWS lo gestiona, se ocupa de que este arriba y altamente disponible
expone un single endpoint
maneja caidas de los downstream servers de forma transparente
Provee SSL 
fuerza stickyness con cookies
provee high availability entre AZs (al crearlo se elige en que AZs ponerlo)
Lleva su Security Group
Separa el trafico publico del privado (?)

Viene integrado con muchos servicios
Hace Health checks

Tipos de Load Balancer:

- 4 tipos de Load Balancers:
> Classic (CLB)         --> Deprecado 
> Application LB (ALB)  --> http, https, websocket
> Network LB (NLB). --> tcp. tls, udp
> Gateway LB (GWLB) --> Opera a nivel 3 (ip protocol)


pueden ser External o internal (privados)

Tienen su propio SG

De modo que : 
El LB admite entradas desde 0.0.0.0/0 al 80 y al 443, por ejemplo
El EC2 conectado al LB solo admite trafico proveniente del SG del load Balancer !!

![[Pasted image 20240530203644.png]]

##### Application LB

Es layer 7 (http)
support ==HTTP, HTTPS and WebSocket==

soporta routing basado en 
- URL paths (myweb/users.  o. myweb/products )
- hostname: one.myweb.com.  two.myweb.com
- basado en query String o Headers : /users?id=123 
  
Soporta mapeo 

Los **"target groups"** pueden ser:
- instancias Ec2
- ECS tasks (?) --> Ejecucion de contenedores docker
- Funciones Lambda
- Direcciones IP (privadas) Por ejemplo un cluster on premise
- Otro ALB (ojo, ALB, no NLB)
  
![[Pasted image 20240601081514.png]]

fijate que hay un link para "create target group".


Los LB tienen un nombre fijo (DNS): xxx.region.elb.amazonaws.com, pero ni IP address publica.

OJO: ==**NO** se puede atachar Elastic IP address a un Application Load Balancer.== Los ALB tienen solo un DNS atachado.

Los health checks se hacen a nivel de target group, no a cada elemento por separado

Las condiciones de trafico se definen dentro del LB:
![[Pasted image 20240601083843.png]]

ej path" is "/error"

Luego sse define la accion para esa condicion:

![[Pasted image 20240601084026.png]]

se puede hacer que un ALB redireccione petiiones http a https, para forzar a los usuarios a usar https.
##### **Network Load Balancer: NLB:** 

Son Capa 4: TCP / UDP traffic
high performance: millones de request / sec
menos latencia, al ser mas bajo nivel (100ms  VS 400ms del ALB)

Ojo: ==**Tiene UN static IP por AZ**== (se le puede asignar Elastic IP)
Tiene tambien su propio SG

Para los health checks del backend soporta HTTPS y HTTP

Los target groups de un Network LB:

- Ec2 Group
- IP adresses (privadas), incluso de un onPrem
- Un ALB --> de este modo la app se expone solo en determinada IP con el NLB

![[Pasted image 20240601085618.png]]


Los ELB proporcionan un DNS (la URL).
==Only Network Load Balancer provides both static DNS name and static IP.== 
==While, Application Load Balancer provides a static DNS name but it does NOT provide a static IP.==

Cuando usas un ALB, la ip que reciben las EC2 es obviamente la del ALB. Para poder obtener las IPs de los clentes conectados, necesitas que la app la recoja del "x-forwarded-for" header.

##### Gateway LB

sirve para desviar el trafico por ejemplo a un firewall, sistemas de terceros para deteccion o analisis de trafico...

![[Pasted image 20240601092214.png]]
 
 Target groups:
- Ec2 Group
- IP adresses (privadas), incluso de un onPrem

----

Se puede implementar ==Sticky sessions== en los ELB (Classic, Application y Network LB, no el GW)

ojo, el network LB no admite cookies.

cookies: 
- Application-based
	- Custom cookie. --> generated by target
	- Application cookie --> generated by LB
- Duration-based --> generated by LB

![[Pasted image 20240601093149.png]]

---

**Cross-Zone Load balancing**

Es una tecnica que simplemente distribuye homogeneamente el trafico enntre EC2 que estan en distintas AZ como si estuvieran en la misma. 

Puede ser deseable o no...

![[Pasted image 20240601093710.png]]

Con ALB esta habilitado por defecto y no pagas mas por el trafico entre zonas
Con NLB y GLB NO esta habilitado y si lo habilitas pagas el trafico entre zonas.

---

**Draining**: No se sirven mas a una instancia unhealthy. Se puede configurar hasta 1 hora (3600 secs). El default son 300 secs (5 mins)

----

##### AutoScaling Groups

- Para cargas no predecibles
- se define un max y un min
- se registran instancias automaticamente al Load Balancer
- se recrean las instancias automaticamente
- son gratis

La combinacion logica es load Balancer + AutoScaling Group.

**Launch Template**: 
Los **atributos** de un ASG son los mismos que los de las EC2 (instance type, SG, ssh keys, AMI, volumenses de EBS, IAM roles...) y aparte lleva el min-max y las policies de escalado.
También si está linkado a algun LB

Se puede escalar un ASG basado en alertas de CloudWatch, basado en metricas como averge CPU 

**Cooldown period**: Significa que despues de escalar o terminar una instancia, entramos en cooldown period, que implica que en los siguientes X seconds (300 por defecto) no se hacen mas escalados para dejar que las metricas se estabilicen
si se usa una ami customizada, mejor. Eso acelera la disponibilidad de la imagen.

**Scaling**: 
 - Dynamic:  basado en una metrica
 - Scheduled: ej. Aumenta la capacidad el sabado.
 - Predictive: Basada en datos anteriores

---

Server Name Indication (SNI) allows you to expose multiple HTTPS applications each with its own SSL certificate on the same listener

Se puede tener un ASG asociado a varias AZ

![[Pasted image 20240602083523.png]]

